<template>
  <div class="area-header"
  >
    <div class="area-header-top" style="z-index: 10000;display: flex">
      <MenuList style="z-index: 100;margin-left: 5px"></MenuList>
      <img alt="logo" src="../../assets/bg_white.png"
           @click="showMenu"
           style="position: absolute; left: 5px; top: 0; width: 40px; height: 40px; opacity: 1;"/>
      <BreadCrumb :items="data" style="position:absolute; margin-left: 60px;"></BreadCrumb>
      <ModeChoose class="area-header-mode"></ModeChoose>
    </div>
    <div class="area-header-bot" style="z-index: 10;display: flex">
      <button style="margin-left: 10px">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1"
             width="10" height="10" viewBox="0 0 10 10">
          <defs>
            <clipPath id="master_svg0_6_132">
              <rect x="0" y="0" width="10" height="10" rx="0"/>
            </clipPath>
          </defs>
          <g clip-path="url(#master_svg0_6_132)">
            <g>
              <path
                  d="M4.16667,0.8333330154418945C4.39667,0.8333330154418945,4.58333,1.0200000154418944,4.58333,1.2500000154418944L4.58333,2.9166630154418947C4.58333,3.1466630154418946,4.39667,3.3333330154418945,4.16667,3.3333330154418945L3.33333,3.3333330154418945L3.33333,4.166663015441895L5.41667,4.166663015441895L5.41667,3.7500030154418944C5.41667,3.5200030154418944,5.60333,3.3333330154418945,5.83333,3.3333330154418945L8.33333,3.3333330154418945C8.56333,3.3333330154418945,8.75,3.5200030154418944,8.75,3.7500030154418944L8.75,5.416663015441895C8.75,5.646663015441894,8.56333,5.8333330154418945,8.33333,5.8333330154418945L5.83333,5.8333330154418945C5.60333,5.8333330154418945,5.41667,5.646663015441894,5.41667,5.416663015441895L5.41667,5.000003015441894L3.33333,5.000003015441894L3.33333,7.500003015441894L5.41667,7.500003015441894L5.41667,7.0833330154418945C5.41667,6.853333015441894,5.60333,6.666663015441895,5.83333,6.666663015441895L8.33333,6.666663015441895C8.56333,6.666663015441895,8.75,6.853333015441894,8.75,7.0833330154418945L8.75,8.750003015441894C8.75,8.980003015441895,8.56333,9.166663015441895,8.33333,9.166663015441895L5.83333,9.166663015441895C5.60333,9.166663015441895,5.41667,8.980003015441895,5.41667,8.750003015441894L5.41667,8.333333015441895L2.91667,8.333333015441895C2.68667,8.333333015441895,2.5,8.146663015441895,2.5,7.916663015441895L2.5,3.3333330154418945L1.666667,3.3333330154418945C1.436667,3.3333330154418945,1.25,3.1466630154418946,1.25,2.9166630154418947L1.25,1.2500000154418944C1.25,1.0200000154418944,1.436667,0.8333330154418945,1.666667,0.8333330154418945L4.16667,0.8333330154418945ZM7.91667,7.500003015441894L6.25,7.500003015441894L6.25,8.333333015441895L7.91667,8.333333015441895L7.91667,7.500003015441894ZM7.91667,4.166663015441895L6.25,4.166663015441895L6.25,5.000003015441894L7.91667,5.000003015441894L7.91667,4.166663015441895ZM3.75,1.6666660154418946L2.083333,1.6666660154418946L2.083333,2.5000030154418944L3.75,2.5000030154418944L3.75,1.6666660154418946Z"
                  fill="#474747" fill-opacity="1"/>
            </g>
          </g>
        </svg>
      </button>
      <button style="margin-left: 10px">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1"
             width="10" height="10" viewBox="0 0 10 10">
          <defs>
            <clipPath id="master_svg0_3_6480">
              <rect x="0" y="0" width="10" height="10" rx="0"/>
            </clipPath>
          </defs>
          <g style="mix-blend-mode:passthrough" clip-path="url(#master_svg0_3_6480)">
            <g style="mix-blend-mode:passthrough">
              <path
                  d="M1.6666679382324219,1.666666969116211C1.5561579382324218,1.666666969116211,1.4501779382324218,1.7105669691162109,1.3720389382324218,1.788704969116211C1.2939009382324218,1.8668439691162109,1.250000938232422,1.9728239691162108,1.250000938232422,2.083333969116211C1.250000938232422,2.083333969116211,1.250000938232422,7.916663969116211,1.250000938232422,7.916663969116211C1.250000938232422,8.027163969116211,1.2939009382324218,8.133163969116211,1.3720389382324218,8.21129396911621C1.4501779382324218,8.289413969116211,1.5561579382324218,8.333333969116211,1.6666679382324219,8.333333969116211C1.6666679382324219,8.333333969116211,8.333337938232422,8.333333969116211,8.333337938232422,8.333333969116211C8.443837938232422,8.333333969116211,8.549837938232422,8.289413969116211,8.627957938232422,8.21129396911621C8.706087938232422,8.133163969116211,8.749997938232422,8.027163969116211,8.749997938232422,7.916663969116211C8.749997938232422,7.916663969116211,8.749997938232422,3.333333969116211,8.749997938232422,3.333333969116211C8.749997938232422,3.222823969116211,8.706087938232422,3.116843969116211,8.627957938232422,3.0387039691162108C8.549837938232422,2.960563969116211,8.443837938232422,2.916663969116211,8.333337938232422,2.916663969116211C8.333337938232422,2.916663969116211,4.583337938232422,2.916663969116211,4.583337938232422,2.916663969116211C4.444017938232422,2.916663969116211,4.313927938232422,2.847043969116211,4.236647938232422,2.731123969116211C4.236647938232422,2.731123969116211,3.5270079382324218,1.666666969116211,3.5270079382324218,1.666666969116211C3.5270079382324218,1.666666969116211,1.6666679382324219,1.666666969116211,1.6666679382324219,1.666666969116211C1.6666679382324219,1.666666969116211,1.6666679382324219,1.666666969116211,1.6666679382324219,1.666666969116211ZM0.7827849382324219,1.199450969116211C1.017205938232422,0.965029969116211,1.335146938232422,0.8333339691162109,1.6666679382324219,0.8333339691162109C1.6666679382324219,0.8333339691162109,3.749997938232422,0.8333339691162109,3.749997938232422,0.8333339691162109C3.8893179382324217,0.8333339691162109,4.019407938232422,0.902959369116211,4.096687938232422,1.018875969116211C4.096687938232422,1.018875969116211,4.806337938232422,2.083333969116211,4.806337938232422,2.083333969116211C4.806337938232422,2.083333969116211,8.333337938232422,2.083333969116211,8.333337938232422,2.083333969116211C8.664877938232422,2.083333969116211,8.982797938232421,2.215033969116211,9.217207938232422,2.449453969116211C9.451627938232422,2.683873969116211,9.583337938232422,3.001813969116211,9.583337938232422,3.333333969116211C9.583337938232422,3.333333969116211,9.583337938232422,7.916663969116211,9.583337938232422,7.916663969116211C9.583337938232422,8.248213969116211,9.451627938232422,8.56612396911621,9.217207938232422,8.80054396911621C8.982797938232421,9.03496396911621,8.664877938232422,9.166663969116211,8.333337938232422,9.166663969116211C8.333337938232422,9.166663969116211,1.6666679382324219,9.166663969116211,1.6666679382324219,9.166663969116211C1.335146938232422,9.166663969116211,1.017205938232422,9.03496396911621,0.7827849382324219,8.80054396911621C0.5483639382324219,8.56612396911621,0.4166679382324219,8.248213969116211,0.4166679382324219,7.916663969116211C0.4166679382324219,7.916663969116211,0.4166679382324219,2.083333969116211,0.4166679382324219,2.083333969116211C0.4166679382324219,1.751812969116211,0.5483639382324219,1.433871969116211,0.7827849382324219,1.199450969116211C0.7827849382324219,1.199450969116211,0.7827849382324219,1.199450969116211,0.7827849382324219,1.199450969116211ZM4.999997938232422,4.166663969116211C5.230127938232422,4.166663969116211,5.416667938232422,4.3532139691162115,5.416667938232422,4.583333969116211C5.416667938232422,4.583333969116211,5.416667938232422,5.416663969116211,5.416667938232422,5.416663969116211C5.416667938232422,5.416663969116211,6.249997938232422,5.416663969116211,6.249997938232422,5.416663969116211C6.480127938232422,5.416663969116211,6.666667938232422,5.603213969116211,6.666667938232422,5.833333969116211C6.666667938232422,6.063463969116211,6.480127938232422,6.250003969116211,6.249997938232422,6.250003969116211C6.249997938232422,6.250003969116211,5.416667938232422,6.250003969116211,5.416667938232422,6.250003969116211C5.416667938232422,6.250003969116211,5.416667938232422,7.083333969116211,5.416667938232422,7.083333969116211C5.416667938232422,7.313463969116211,5.230127938232422,7.500003969116211,4.999997938232422,7.500003969116211C4.769877938232422,7.500003969116211,4.583337938232422,7.313463969116211,4.583337938232422,7.083333969116211C4.583337938232422,7.083333969116211,4.583337938232422,6.250003969116211,4.583337938232422,6.250003969116211C4.583337938232422,6.250003969116211,3.749997938232422,6.250003969116211,3.749997938232422,6.250003969116211C3.5198879382324217,6.250003969116211,3.3333379382324217,6.063463969116211,3.3333379382324217,5.833333969116211C3.3333379382324217,5.603213969116211,3.5198879382324217,5.416663969116211,3.749997938232422,5.416663969116211C3.749997938232422,5.416663969116211,4.583337938232422,5.416663969116211,4.583337938232422,5.416663969116211C4.583337938232422,5.416663969116211,4.583337938232422,4.583333969116211,4.583337938232422,4.583333969116211C4.583337938232422,4.3532139691162115,4.769877938232422,4.166663969116211,4.999997938232422,4.166663969116211C4.999997938232422,4.166663969116211,4.999997938232422,4.166663969116211,4.999997938232422,4.166663969116211Z"
                  fill-rule="evenodd" fill="#474747" fill-opacity="1"/>
            </g>
          </g>
        </svg>
      </button>
      <button style="margin-left: 10px">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1"
             width="10" height="10" viewBox="0 0 10 10">
          <defs>
            <clipPath id="master_svg0_3_6482">
              <rect x="0" y="0" width="10" height="10" rx="0"/>
            </clipPath>
          </defs>
          <g style="mix-blend-mode:passthrough" clip-path="url(#master_svg0_3_6482)">
            <g style="mix-blend-mode:passthrough">
              <path
                  d="M1.616117,0.7827830308837891C1.850537,0.5483620308837891,2.168479,0.41666603088378906,2.5,0.41666603088378906C2.5,0.41666603088378906,5.83333,0.41666603088378906,5.83333,0.41666603088378906C5.94383,0.41666603088378906,6.04983,0.4605648308837891,6.12796,0.5387050308837891C6.12796,0.5387050308837891,8.62796,3.038706030883789,8.62796,3.038706030883789C8.70608,3.116846030883789,8.75,3.2228260308837893,8.75,3.333336030883789C8.75,3.333336030883789,8.75,8.333336030883789,8.75,8.333336030883789C8.75,8.66487603088379,8.61829,8.982796030883788,8.38387,9.217206030883789C8.149460000000001,9.451626030883789,7.83154,9.583336030883789,7.5,9.583336030883789C7.5,9.583336030883789,2.5,9.583336030883789,2.5,9.583336030883789C2.168479,9.583336030883789,1.850537,9.451626030883789,1.616117,9.217206030883789C1.381696,8.982796030883788,1.25,8.66487603088379,1.25,8.333336030883789C1.25,8.333336030883789,1.25,1.666666030883789,1.25,1.666666030883789C1.25,1.335145030883789,1.381696,1.017204030883789,1.616117,0.7827830308837891C1.616117,0.7827830308837891,1.616117,0.7827830308837891,1.616117,0.7827830308837891ZM2.5,1.2499990308837892C2.38949,1.2499990308837892,2.2835099999999997,1.293899030883789,2.205371,1.372037030883789C2.127233,1.450176030883789,2.083333,1.556156030883789,2.083333,1.666666030883789C2.083333,1.666666030883789,2.083333,8.333336030883789,2.083333,8.333336030883789C2.083333,8.443836030883789,2.127233,8.549836030883789,2.205371,8.627956030883789C2.2835099999999997,8.706086030883789,2.38949,8.74999603088379,2.5,8.74999603088379C2.5,8.74999603088379,7.5,8.74999603088379,7.5,8.74999603088379C7.6105,8.74999603088379,7.7165,8.706086030883789,7.79462,8.627956030883789C7.87275,8.549836030883789,7.91667,8.443836030883789,7.91667,8.333336030883789C7.91667,8.333336030883789,7.91667,3.749996030883789,7.91667,3.749996030883789C7.91667,3.749996030883789,5.83333,3.749996030883789,5.83333,3.749996030883789C5.60321,3.749996030883789,5.41667,3.563446030883789,5.41667,3.333336030883789C5.41667,3.333336030883789,5.41667,1.2499990308837892,5.41667,1.2499990308837892C5.41667,1.2499990308837892,2.5,1.2499990308837892,2.5,1.2499990308837892C2.5,1.2499990308837892,2.5,1.2499990308837892,2.5,1.2499990308837892ZM6.25,1.839256030883789C6.25,1.839256030883789,7.32742,2.916666030883789,7.32742,2.916666030883789C7.32742,2.916666030883789,6.25,2.916666030883789,6.25,2.916666030883789C6.25,2.916666030883789,6.25,1.839256030883789,6.25,1.839256030883789C6.25,1.839256030883789,6.25,1.839256030883789,6.25,1.839256030883789ZM5,4.583336030883789C5.230119999999999,4.583336030883789,5.41667,4.769876030883789,5.41667,4.999996030883789C5.41667,4.999996030883789,5.41667,5.833336030883789,5.41667,5.833336030883789C5.41667,5.833336030883789,6.25,5.833336030883789,6.25,5.833336030883789C6.48012,5.833336030883789,6.66667,6.019876030883789,6.66667,6.249996030883789C6.66667,6.480126030883789,6.48012,6.666666030883789,6.25,6.666666030883789C6.25,6.666666030883789,5.41667,6.666666030883789,5.41667,6.666666030883789C5.41667,6.666666030883789,5.41667,7.499996030883789,5.41667,7.499996030883789C5.41667,7.730126030883789,5.230119999999999,7.916666030883789,5,7.916666030883789C4.769880000000001,7.916666030883789,4.58333,7.730126030883789,4.58333,7.499996030883789C4.58333,7.499996030883789,4.58333,6.666666030883789,4.58333,6.666666030883789C4.58333,6.666666030883789,3.75,6.666666030883789,3.75,6.666666030883789C3.51988,6.666666030883789,3.33333,6.480126030883789,3.33333,6.249996030883789C3.33333,6.019876030883789,3.51988,5.833336030883789,3.75,5.833336030883789C3.75,5.833336030883789,4.58333,5.833336030883789,4.58333,5.833336030883789C4.58333,5.833336030883789,4.58333,4.999996030883789,4.58333,4.999996030883789C4.58333,4.769876030883789,4.769880000000001,4.583336030883789,5,4.583336030883789C5,4.583336030883789,5,4.583336030883789,5,4.583336030883789Z"
                  fill-rule="evenodd" fill="#474747" fill-opacity="1"/>
            </g>
          </g>
        </svg>
      </button>
      <button style="margin-left: 10px">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1"
             width="10" height="10" viewBox="0 0 10 10">
          <defs>
            <clipPath id="master_svg0_20_1918">
              <rect x="0" y="0" width="10" height="10" rx="0"/>
            </clipPath>
          </defs>
          <g clip-path="url(#master_svg0_20_1918)">
            <g>
              <path
                  d="M8.75,1.25L8.75,2.083333C8.75,6.09458,6.51125,7.91667,3.75,7.91667L2.9575,7.91667C3.04583,6.66167,3.43667,5.90208,4.45667,4.99958C4.95833,4.55583,4.91583,4.299580000000001,4.66875,4.44667C2.96708,5.45917,2.122083,6.8275,2.084583,9.0125L2.083333,9.16667L1.25,9.16667C1.25,8.598749999999999,1.2983333,8.08333,1.394167,7.61167C1.2983333,7.0725,1.25,6.34083,1.25,5.41667C1.25,3.1154200000000003,3.1154200000000003,1.25,5.41667,1.25C6.25,1.25,7.08333,1.666667,8.75,1.25Z"
                  fill="#3D3D3D" fill-opacity="1"/>
            </g>
          </g>
        </svg>
      </button>
      <input
            type="text"
            class="area-search-tab"
            placeholder="全局搜索"
        >
      <div style="margin-top: 8px;margin-left: 10px;z-index: 1000">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1"
             width="10" height="10" viewBox="0 0 10 10">
          <defs>
            <clipPath id="master_svg0_3_6595">
              <rect x="0" y="0" width="10" height="10" rx="0"/>
            </clipPath>
          </defs>
          <g style="mix-blend-mode:passthrough" clip-path="url(#master_svg0_3_6595)">
            <g style="mix-blend-mode:passthrough">
              <path
                  d="M4.583335876464844,1.6666631544189454C2.9725058764648438,1.6666631544189454,1.6666688764648439,2.9725001544189453,1.6666688764648439,4.583330154418945C1.6666688764648439,6.194160154418945,2.9725058764648438,7.500000154418945,4.583335876464844,7.500000154418945C5.369125876464844,7.500000154418945,6.082375876464844,7.1892501544189455,6.606835876464844,6.683910154418945C6.617795876464844,6.6696601544189456,6.6297958764648435,6.655910154418946,6.642875876464844,6.6428701544189455C6.655915876464844,6.629790154418945,6.669665876464844,6.6177901544189455,6.683915876464844,6.606830154418946C7.189255876464844,6.082370154418945,7.500005876464844,5.369120154418946,7.500005876464844,4.583330154418945C7.500005876464844,2.9725001544189453,6.194165876464844,1.6666631544189454,4.583335876464844,1.6666631544189454C4.583335876464844,1.6666631544189454,4.583335876464844,1.6666631544189454,4.583335876464844,1.6666631544189454ZM7.513295876464844,6.924040154418945C8.026455876464844,6.282500154418945,8.333335876464844,5.468750154418945,8.333335876464844,4.583330154418945C8.333335876464844,2.5122601544189456,6.654415876464844,0.8333301544189453,4.583335876464844,0.8333301544189453C2.512265876464844,0.8333301544189453,0.8333358764648438,2.5122601544189456,0.8333358764648438,4.583330154418945C0.8333358764648438,6.654410154418946,2.512265876464844,8.333330154418945,4.583335876464844,8.333330154418945C5.468755876464844,8.333330154418945,6.282505876464843,8.026460154418945,6.924045876464843,7.513290154418946C6.924045876464843,7.513290154418946,8.455375876464844,9.044620154418945,8.455375876464844,9.044620154418945C8.618085876464843,9.207330154418946,8.881915876464843,9.207330154418946,9.044625876464844,9.044620154418945C9.207335876464844,8.881910154418945,9.207335876464844,8.618080154418944,9.044625876464844,8.455370154418945C9.044625876464844,8.455370154418945,7.513295876464844,6.924040154418945,7.513295876464844,6.924040154418945C7.513295876464844,6.924040154418945,7.513295876464844,6.924040154418945,7.513295876464844,6.924040154418945Z"
                  fill-rule="evenodd" fill="#767676" fill-opacity="1"/>
            </g>
          </g>
        </svg>
      </div>
      <TabList :open-files="openFiles" :cur-obj="curObj"></TabList>
      <button style="position: absolute; margin-left: 1480px;margin-top: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1"
             width="15" height="15" viewBox="0 0 15 15">
          <defs>
            <clipPath id="master_svg0_10_626">
              <rect x="0" y="0" width="15" height="15" rx="0"/>
            </clipPath>
          </defs>
          <g clip-path="url(#master_svg0_10_626)">
            <g>
              <path
                  d="M7.5,13.75C4.0481300000000005,13.75,1.25,10.95188,1.25,7.5C1.25,4.04812,4.0481300000000005,1.25,7.5,1.25C10.95187,1.25,13.75,4.0481300000000005,13.75,7.5C13.75,10.95187,10.95187,13.75,7.5,13.75ZM6.875,6.875L6.875,10.625L8.125,10.625L8.125,6.875L6.875,6.875ZM6.875,4.375L6.875,5.625L8.125,5.625L8.125,4.375L6.875,4.375Z"
                  fill="#474747" fill-opacity="1"/>
            </g>
          </g>
        </svg>
      </button>
      <button style="position: absolute; margin-left: 1500px;margin-top: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1"
             width="15" height="15" viewBox="0 0 15 15">
          <g style="mix-blend-mode:passthrough">
            <path
                d="M0.224609,13.125L3.41797,13.125L3.41797,12.2852L2.12891,12.2852L2.9541,9.6875L6.77734,9.6875L7.63184,12.2852L6.34277,12.2852L6.34277,13.125L10.3809,13.125L10.3809,12.2852L9.59961,12.2852L6.20605,2.5L4.39453,2.5L1.00098,12.2852L0.224609,12.2852L0.224609,13.125ZM4.84375,3.97461L4.91699,3.97461L6.52344,8.81836L3.22266,8.81836L4.84375,3.97461Z"
                fill="#474747" fill-opacity="1"/>
          </g>
        </svg>
      </button>
    </div>
  </div>
</template>

<script>
import { ref } from 'vue'
import bus from 'vue3-eventbus'
import MenuList from '@/renderer/components/header/MenuList'
import BreadCrumb from '@/renderer/components/header/BreadCrumb'
import ModeChoose from '@/renderer/components/header/ModeChoose'
import TabList from '@/renderer/components/header/TabList'

export default {
  name: 'MyHeader',
  components: { TabList, ModeChoose, BreadCrumb, MenuList },
  props: {
    data: {
      type: Array,
      required: true
    }
  },
  setup () {
    const openFiles = ref([]) // 存对象，浅比较（ === 引用相同），深比较（值相同）
    const curObj = ref({}) // 维护现在打开的文件对象
    const content = ref('') // 当前工作区文本内容
    const wordCnt = ref(0) // 当前工作区字符数

    function contain (file) {
      for (let i = 0; i < openFiles.value.length; i++) {
        if (openFiles.value[i].path === file.path) {
          return true
        }
      }
      return false
    }

    // 每次修改openSet（主要是增加和删除）计算特异路径
    function update () {
      // 第一步，将所有对象按名字分组
      const sameNameArrays = []
      const flag = []
      for (let i = 0; i < openFiles.value.length; i++) {
        flag.push(false)
      }

      for (let i = 0; i < openFiles.value.length; i++) {
        if (flag[i]) {
          continue
        }
        const tempArray = []
        tempArray.push(openFiles.value[i])
        for (let j = i + 1; j < openFiles.value.length; j++) {
          if (flag[j]) {
            continue
          }
          if (openFiles.value[i].name === openFiles.value[j].name) {
            tempArray.push(openFiles.value[j])
            flag[j] = true
          }
        }
        if (tempArray.length > 1) {
          flag[i] = true
          sameNameArrays.push(tempArray)
        }
      }

      // 第二步，计算所有组的偏移
      for (let i = 0; i < sameNameArrays.length; i++) {
        let offset = -2
        while (sameNameArrays[i].length + offset >= 0) {
          const nameSet = new Set()
          for (let j = 0; j < sameNameArrays[i].length; j++) {
            // 判断path的倒数第二个是否全部互异\
            const index = sameNameArrays[i][j].absolutePath.length + offset
            nameSet.add(sameNameArrays[i][j].absolutePath[index])
          }
          if (nameSet.size === sameNameArrays[i].length) {
            break
          } else {
            offset--
          }
        }
        for (let j = 0; j < sameNameArrays[i].length; j++) {
          sameNameArrays[i][j].offset = offset // 修改对象的偏移
        }
      }

      // 第三步，将没有重复元素的offset设为-1
      for (let i = 0; i < openFiles.value.length; i++) {
        if (!flag[i]) {
          openFiles.value[i].offset = -1
        }
      }
    }

    bus.on('saveChange', (obj) => {
      content.value = obj.content
      wordCnt.value = obj.wordCnt
    })

    bus.on('sendToTextUI', (obj) => {
      if (curObj.value.path === obj.path) {
        return // 不更新工作区
      }
      // 写回content，是有可能路径不存在的
      if (curObj.value.path) {
        /*
        TODO
         */
        // electron.saveFile(curObj.value.path) // 接口
      }

      curObj.value = obj
      console.log(curObj.value.content)
      content.value = curObj.value.content
      console.log(content.value)
      // 传参给textUI
      /*
      TODO
       */
      bus.emit('setEditorContent', content.value)
    })

    function showMenu () {
      bus.emit('showMenu')
    }

    bus.on('deleteTab', (obj) => {
      obj.offset = -1
      let index = -1
      for (let i = 0; i < openFiles.value.length; i++) {
        if (openFiles.value[i].path === obj.path) {
          index = i
          break
        }
      }
      if (index !== -1) {
        openFiles.value.splice(index, 1)
      }
      if (curObj.value.path === obj.path) {
        if (index === openFiles.value.length) {
          index = 0
        }
        bus.emit('sendToTextUI', openFiles.value[index])
      }
      update()
    })

    bus.on('openNewTab', (obj) => {
      if (contain(obj)) {
        console.log('already open!')
      } else {
        openFiles.value.push(obj)
        update()
      }
      bus.emit('sendToTextUI', obj)
    })

    return { openFiles, update, curObj, content, wordCnt, showMenu }
  }
}
</script>

<style scoped>

</style>
